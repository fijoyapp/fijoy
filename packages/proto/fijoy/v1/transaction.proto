syntax = "proto3";

package fijoy.v1;

import "buf/validate/validate.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

message Transaction {
  string id = 1 [(buf.validate.field).string.min_len = 1];
  string profile_id = 2 [(buf.validate.field).string.min_len = 1];
  string account_id = 3 [(buf.validate.field).string.min_len = 1];

  string amount = 4;
  string amount_delta = 5;
  string value = 6;
  string fx_rate = 7;
  string balance = 8;
  string balance_delta = 9;

  string note = 10;

  google.protobuf.Timestamp created_at = 11 [(buf.validate.field).required = true];
  google.protobuf.Timestamp updated_at = 12 [(buf.validate.field).required = true];
}

message Transactions {
  repeated Transaction transactions = 1 [(buf.validate.field).required = true];
}

message CreateTransactionRequest {
  string account_id = 1 [(buf.validate.field).string.min_len = 1];

  string amount_delta = 2;
  string value = 3;
  string fx_rate = 4;

  string note = 5;
}

message CreateTransactionsRequest {
  repeated CreateTransactionRequest transactions = 1 [(buf.validate.field).required = true];
}

message GetTransactionByIdRequest {
  string id = 1 [(buf.validate.field).string.min_len = 1];
}

message GetTransactionsByAccountIdRequest {
  string account_id = 1 [(buf.validate.field).string.min_len = 1];
}

message DeleteTransactionByIdRequest {
  string id = 1 [(buf.validate.field).string.min_len = 1];
}

service TransactionService {
  rpc CreateTransaction(CreateTransactionRequest) returns (Transaction);
  rpc CreateTransactions(CreateTransactionsRequest) returns (Transactions);

  rpc GetTransactionById(GetTransactionByIdRequest) returns (Transaction) {
    option idempotency_level = NO_SIDE_EFFECTS;
  }

  rpc GetTransactionsByAccountId(GetTransactionsByAccountIdRequest) returns (Transactions) {
    option idempotency_level = NO_SIDE_EFFECTS;
  }

  rpc GetTransactions(google.protobuf.Empty) returns (Transactions) {
    option idempotency_level = NO_SIDE_EFFECTS;
  }

  rpc DeleteTransactionById(DeleteTransactionByIdRequest) returns (google.protobuf.Empty);
}
